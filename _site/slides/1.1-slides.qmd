---
format:
  revealjs:
    theme: [default, custom.scss]
    logo: "images/metrics_hex.png"
    height: 900
    width: 1600
overview: true
execute:
  echo: false
  warning: false
  freeze: auto
---

##  {data-menu-title="Title Slide" background-image="images/metrics_title_slide.png"}

[1.1 --- Introduction to Econometrics]{.custom-title}

[ECON 4470 â€¢ Econometrics]{.custom-subtitle}

[Jordan Izenwasser <br> Slides Adapated from Ryan Safner, PhD]{.custom-author}

```{r}
#| label: setup
#| include: false
library(tidyverse)
library(kableExtra)
library(patchwork)
library(fontawesome)

update_geom_defaults("label", list(family = "Fira Sans Condensed"))
update_geom_defaults("text", list(family = "Fira Sans Condensed"))
```

# What is Econometrics? {.centered background-color="#314f4f"}

## Why Economist use Econometrics

-   [Economics]{.hi} is the study of how society allocates resources and makes choices given scarcity

::: incremental
-   [Economic theory]{.hi} provides us with a framework of understanding *how* society allocates resources and the *impact* of such allocation
    -   Think to micro theory!
        -   If society uses prices as an allocation mechanism and a disease kills 50% of the lemon crop, what would theory suggests happens to the price of lemons?
        -   If a utility maximizing college student is choosing between buying ramen noodles and lobster tail and their income decreases, which good would theory suggest the student buys more of? -Theory can only inform us of the *direction* of an effect, not its *magnitude*!
-   We often care about the magnitude for firm level policy, government policy, etc.
-   [Econometrics]{.hi} is the application of statistical and other empirical tools to quantify economic relationships in the real world
:::

## Role of Econometrics

::: incremental
-   Econometrics is used to:

    -   Determine magnitude of an effect

    -   Make predictions

    -   Test economic theory/hypothesis (does economic theory get the direction right?)

    -   Estimate causal effects between economic variables (more on this later)

-   Econometrics will provide us with [estimates]{.hi} of actual values

    -   Because they are estimates we want our analysis to provide a numerical answer (usually an average) and a measure of precision for the numerical answer (how confident are we that the estimate is equal to the *true* value)

-   Always remember, good theory guides econometric choices and good econometrics can inform theory
:::

## Questions Economists Ask

::: columns
::: {.column width="50%"}
-   Does reducing class size improve educational outcomes?

    -   Small class size can result in more one-on-one time improving test scores

    -   Larger classes may benefit more social students improving test scores

    -   Effect is ambiguous theoretically, but with data we can learn both direction and magnitude of effect

    -   Notice this question is asking about causality!
:::

::: {.column width="50%"}
![](images/testscore.jpg)
:::
:::

## Questions Economists Ask

::: columns
::: {.column width="65%"}
-   Is there racial discrimination in the market for home loans?

    -   Receiving a mortgage is a function of an applicant's risk profile

    -   [Theory]{.underline}: If two applicants are identical in every way except for race they should have the same risk profile and therefore be equally as likely to be approved for a mortgage -

    -   [Reality]{.underline}: All else constant, Black applicants are denied 19% more than White applicants (Fed Reserve Boston using 90's data)

    -   Since Blacks are denied more than Whites *ceterius paribus* there does exist racial discrimination, contrary to what theory predicts
:::

::: {.column width="35%"}
![](images/house.png)
:::
:::

## Questions Economists Ask

::: columns
::: {.column width="65%"}
-   How much do cigarette taxes reduce smoking?

    -   Theory suggest that when a good is taxed, its consumption decreases, all else equal

    -   Theory can't tell us by how much consumption will decrease, therefore we need data and econometrics

    -   Essentially what we are asking is if the sales price of cigs increases by 1%, what is the percent change in cig consumption?

    -   We are interested in estimating an elasticity!
:::

::: {.column width="35%"}
![](images/cig%20Tax.png)
:::
:::

## Questions Economists Ask

::: columns
::: {.column width="40%"}
-   How much will U.S GDP grow next year?

    -   Using past data on GDP and other macroeconomic indicators, can we predict GDP growth?

    -   With what degree of prediction can we do so?
:::

::: {.column width="60%"}
![](images/GDP.png)
:::
:::

## Questions Economists Ask

1)  Does reducing class size improve educational outcomes?
2)  Is there racial discrimination in the market for home loans?
3)  How much do cigarette taxes reduce smoking?
4)  How much will U.S GDP grow next year?

-   Some things to keep in mind throughout the semester:

    ::: incremental
    -   Each question requires a numerical answer. Theory can help us on what we think the answer should be (direction) or what variables to include in our econometric model

    -   Using data requires a sample of the population $\Rightarrow$ uncertainty/imprecision with estimates. Using a different sample can produce different results!

    -   In theory holding all else constant is important. This is very much true in econometrics as well!
    :::
    
# About This Course {.centered background-color="#314f4f"}

## Math Expectations

![](images/opengatemath1.jpg){fig-align="center" width="600"}

## Math Expectations

![](images/opengatemath2.jpg){fig-align="center" width="600"}

## Math Expectations

![](images/opengatemath3.jpg){fig-align="center" width="800"}

## Difficulty

::: columns
::: {.column width="50%"}
-   This will be one of the hardest courses you take at Trinity
-   There will be moments where you have no idea what is going on  (*this is normal*)
-   But this is one of the best courses you can take at Trinity
-   Yes, you can still get an **A**
:::

::: {.column width="50%"}
![](images/difficultclass.png)
:::
:::

## This Class Is

::: columns
::: {.column width="50%"}
-   **Economics**: take your *preexisting* intuition and models for causal inference
-   **Statistics**: add regression and statistical inference
-   **Computer Programming**: using `R` and `R Studio` for analyzing and presenting data
:::

::: {.column width="50%"}
```{r}
class<-data.frame(Percentage=c(50,40,10),
                  Subject=c("Economics","Statistics","Computer Programming"))

#ggplot(class, aes(x="", y=Percentage, fill=Subject))+
#  geom_col()+theme_void()+scale_fill_viridis_d()

library(treemapify)
ggplot(class, aes(area=Percentage, fill=Subject))+
  geom_treemap()+
  guides(fill=F)+
  geom_treemap_text(aes(label = Subject),
                  colour = "white",
                  place = "topleft",
                  reflow = T,
                  grow = TRUE)+
  #scale_fill_brewer(palette="viridis")+
  scale_fill_viridis_d()
```
:::
:::

## 

::: columns
::: {.column width="50%"}
### [Old School Metrics Courses]{style="color:#6A5ACD;"}

-   $\bar{x} = \frac{1}{n} \displaystyle\sum^n_{i=1} x_i$

-   $\sigma_x = \displaystyle \sqrt{\frac{1}{n} \sum^n_{i=1} (x_i-\bar{x})^2}$

-   $r_{xy}= \displaystyle \frac{\displaystyle\sum^n_{i=1}(x_i-\bar{x})(y_i-\bar{y})}{\sqrt{\displaystyle\sum^n_{i=1}(x_i-\bar{x})^2\sum^n_{i=1}(y_i-\bar{y})^2}}$

-   Use pre-cleaned "toy" data, if at all
-   Heavy focus on derivations 
:::

::: {.column width="50%"}
### [This Course]{style="color:#e64173;"}

```{r}
#| echo: true
#| eval: false

mean(x)
sd(x)
cor(x, y)
```

-   Import, tidy, and manipulate raw data from scratch (like *real life*!)
-   Will still do derivations, put emphasize modern econometric methods, some data science, and how to produce applied research using econometrics 
:::
:::

## Prerequisites

-   **Officially (Courses)**:
    -   Principles of Macro
    -   Intermediate Micro
    -   Business Stats
    -   Calculus 2

. . .

-   **Math Skills**:
    -   Algebra
    -   Probability-ish
    -   Statistics-ish
    -   Calculus

. . .

-   **Programming Skills**:
    -   None 

## What You'll Get Out of This Class

::: columns
::: {.column width="50%"}
By the end of this semester, you will:

1.  understand how to evaluate statistical and empirical claims;
2.  use the fundamental models of causal inference and research design;
3.  gather, analyze, and communicate with real data in R.
:::

::: {.column width="50%"}
![](images/r.png)
:::
:::


## Two Types of Uses For Econometrics

$$\color{orange}{Y}=\color{teal}{f}(\color{purple}{X})$$

::: columns
::: {.column width="50%"}
1.  [Causal inference]{.hi}: estimate $\color{teal}{\hat{f}}$ to determine how changes in $\color{purple}{X}$ **cause** changes in $\color{orange}{Y}$

-   Care more about accurately estimating $\color{teal}{f}$ than getting an accurate $\color{orange}{\hat{Y}}$
-   Measure the **causal effect** of $X \mapsto Y$
-   primarily regression-based
:::

::: {.column width="50"}
2.  [Prediction]{.hi}: predict $\color{orange}{\hat{Y}}$ using an estimated $\color{teal}{f}$

-   Care more about getting $\color{orange}{\hat{Y}}$ as accurate as possible, $\color{teal}{f}$ is an unknown "black-box"
-   Use for **forecasting**, **classification**, etc.
-   less regression, more machine-learning methods
:::
:::

. . .

-   More and more "data science" focuses on the second...but

. . .

-   We care (in this class at least) only about the first...because

## Causal Inference --- Economists' Comparative Advantage

::: columns
::: {.column width="50%"}

-   With the right models and research designs, we *can* say "X causes Y" and quantify it!
-   Economists are in a unique position to make *causal* claims that mere statistics cannot
:::

::: {.column width="50%"}
![](images/coding.jpeg)
:::
:::



## Causal Inference --- Economists' Comparative Advantage

::: columns
::: {.column width="40%"}
![](images/econtechcompanies.png) [Harvard Business Review](https://hbr.org/2019/02/why-tech-companies-hire-so-many-economists)
:::

::: {.column width="60%"}
"\[T\]he field of economics has spent decades developing a toolkit aimed at investigating empirical relationships, focusing on techniques to help understand which correlations speak to a causal relationship and which do not. This comes up all the time --- does Uber Express Pool grow the full Uber user base, or simply draw in users from other Uber products? Should eBay advertise on Google, or does this simply syphon off people who would have come through organic search anyway? Are African-American Airbnb users rejected on the basis of their race? These are just a few of the countless questions that tech companies are grappling with, investing heavily in understanding the extent of a causal relationship."
:::
:::



## Your Textbooks

::: columns
::: {.column width="50%"}
![](images/baileyeconometrics.jpg){width="500"}
:::

::: {.column width="50%"}
![](images/r4ds.png){width="500"}
:::
:::









# Causality {.centered background-color="#314f4f"}

## Smoking

::: columns
::: {.column width="50%"}
-   In 1964 the U.S Surgeon General issued a report claiming that cigarette smoking *causes* lung cancer
    -   Used evidence based on *correlations* between cig smoking and lung cancer
    -   Is this enough to establish causality?
:::

::: {.column width="50%"}
![](images/cig.png)
:::
:::

## Smoking

::: columns
::: {.column width="50%"}
-   Obviously, the tobacco companies didn't think so!
-   And neither did Ronald Fisher, the "father of modern statistics"
    -   He claimed there could be a 'hidden' variable (maybe genetics) that causes *both* lung cancer AND people wanting to smoke (nicotine craving)
    -   If true, despite a correlation between smoking and lung cancer, the act of smoking would have no impact on whether you get lung cancer!
-   We can represent these statistical links using a [directed acyclic graph (DAG)]{.hi}
:::

::: {.column width="50%"}
[**Surgeon General's DAG**]{.underline}

```{r}
library("ggdag")
dagify(Y~X,
       exposure = "X",
       outcome = "Y",
       labels = c("X" = "Smoking", "Y" = "Cancer"),
       coords = list(x = c(X = 1, Y = 0, Z = -1),
                  y = c(X = 1, Y = 0, Z = 1))
      ) %>% 
  tidy_dagitty() %>%
  node_status() %>%
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges()+
  geom_dag_point(aes(color = status), size = 15)+
  #geom_dag_text(size = 5)+
  geom_dag_text_repel(aes(label = label),
                      size = 5,
                      seed = 2,
                      #direction = "y",
                      #nudge_y = -1.25,
                      box.padding = 1.5,
                      segment.alpha = 0)+
  #scale_color_manual(values = c("#FF4136", "#0074D9"),
  #                   na.value = "#7FDBFF") +
  guides(color = F)+
  theme_dag(base_family = "Fira Sans Condensed")
```
:::
:::

## Smoking

::: columns
::: {.column width="50%"}
-   Obviously, the tobacco companies didn't think so!
-   And neither did Ronald Fisher, the "father of modern statistics"
    -   He claimed there could be a 'hidden' variable (maybe genetics) that causes *both* lung cancer AND people wanting to smoke (nicotine craving)
    -   If true, despite a correlation between smoking and lung cancer, the act of smoking would have no impact on whether you get lung cancer!
-   We can represent these statistical links using a [directed acyclic graph (DAG)]{.hi}
:::

::: {.column width="50%"}
[**Fisher's DAG**]{.underline}

```{r}
library("ggdag")
dagify(Y~X+Z,
       X~Z,
       exposure = "X",
       outcome = "Y",
       labels = c("X" = "Smoking", "Y" = "Cancer", "Z" = "Gene"),
       coords = list(x = c(X = 1, Y = 0, Z = -1),
                  y = c(X = 1, Y = 0, Z = 1))
      ) %>% 
  tidy_dagitty() %>%
  node_status() %>%
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges()+
  geom_dag_point(aes(color = status), size = 15)+
  #geom_dag_text(size = 5)+
  geom_dag_text_repel(aes(label = label),
                      size = 5,
                      seed = 2,
                      #direction = "y",
                      #nudge_y = -1.25,
                      box.padding = 1.5,
                      segment.alpha = 0)+
  #scale_color_manual(values = c("#FF4136", "#0074D9"),
  #                   na.value = "#7FDBFF") +
  guides(color = F)+
  theme_dag(base_family = "Fira Sans Condensed")
```
:::
:::

## Smoking

::: columns
::: {.column width="50%"}
-   There could be a [confounding variable]{.hi} ("smoking gene") that causes *both* lung cancer *and* the urge to smoke

-   Would imply: decision to smoke or not would have *no impact* on lung cancer!

-   Correlation between smoking and cancer is spurious!
:::

::: {.column width="50%"}
:::
:::

## Correlation Does Not Imply Causation

-   The goal of every intro statistics class ever

![](images/xkcdcorrelation.png){width="750" fig-align="center"}

[XKCD: Correlation](https://xkcd.com/552/)

## Correlation Does Not Imply Causation

![](images/spuriouscorr1.png){width="750" fig-align="center"}

[Spurious Correlations](http://www.tylervigen.com/spurious-correlations)

## Correlation Does Not Imply Causation...

::: columns
::: {.column width="50%"}
-   It's always good to be skeptical of causal claims

    -   But this is actually where econometrics shines

-   We can't infer$X$ causes $Y$ from correlation alone for several reasons

    -   A confounding variable is affecting $X$ and $Y$

        -   Not taking confounding variables into account can harm the accuracy of our estimates. This is known as [omitted variable bias]{.hi} (much more on this later) and the conclusion that something is causal even if it isn't
:::

::: {.column width="50%"}
![](images/causation.jpg)
:::
:::

## Correlation Does Not Imply Causation...

::: columns
::: {.column width="50%"}
-   It's always good to be skeptical of causal claims

    -   But this is actually where econometrics shines

-   We can't infer$X$ causes $Y$ from correlation alone for several reasons

    -   A confounding variable is affecting $X$ and $Y$
    -   Maybe $Y$ causes $X$, or both cause each other ([reverse causation]{.hi})
        -   What is the kid's DAG vs. the actual DAG?
:::

::: {.column width="50%"}
![](images/Turbulance.png)
:::
:::

## Causal Effects

-   What exactly do we mean by causality?

::: incremental
-   An action is said to [cause]{.hi} an outcome if the outcome is a direct result or consequence of the action
    -   Studying more *causes* higher test scores
    -   Fertilizing plants *causes* improved growth
    -   Running *causes* your heart to beat faster
-   Suppose we want to measure the [causal effect]{.hi} of fertilizer on tomato yield
    -   Put another way, we want to identify if fertilizer causes tomato yield to improve
    -   How would we measure this?
    -   Through a [randomized control experiment]{.hi}!
:::

## Randomized Control Experiments

-   Suppose we find wild tomato plants and give them fertilize and observe how this changes the quantity of fruit

::: incremental
-   This is not enough to establish causality since there may be unobserved factors that vary for the different pants (i.e soil quality, water, sunlight)
-   Further, if we fertilize all the wild plants we have no [counterfactual]{.hi} to compare the fruiting to
    -   That is, no plant that didn't receive fertilize but had all other factors the same
-   This is why we require randomized controlled experiments:
    1)  To ensure we control for all confounding variables
    2)  Have a valid counterfactual group ([control group]{.hi})
:::

## Randomized Control Experiments

-   What do we need to run an RCE?

::: incremental
1)  [Treatment group]{.hi} - group that receives the intervention (i.e fertilizer). Ideally, we would like different plants to receive different amounts of fertilize (i.e some plants 10g, 20g,...) to estimate the magnitude of the effect and not just establish causlity

2)  [Control group]{.hi} - group that does not recieve intervention

3)  [Randomized assignment]{.hi} - tomato plants are randomly assigned to groups; eliminates possibility of a systematic relationship between confounders (like sunlight) and outcomes

-   To estimate causal effect, we compare tomato amount from treatment group relative to control group

-   Random assignment is VERY important because it allows us to not worry about confounders
:::

## Random Assignment

-   To illustrate why random assignment is critical consider the tomato experiment

::: columns
::: {.column width="50%"}
![](images/Random%20Assign%201.png)
:::

::: {.column width="50%"}
-   Suppose we have a [control group]{.hi-turquoise} and a [treatment group]{.hi}, where each circle represents a plant.

-   The control group is entirely in the sun and the treatment group in the shade.

-   We would observe that fertilizer reduces plant the quantity of tomatoes.

-   This would be inferring incorrect causality because we don't have random assignment and there for are failing to control for a confounder.
:::
:::

## Random Assignment

-   Now suppose we have random assignment, where plants are randomly assigned treatment and control groups

::: columns
::: {.column width="50%"}
![](images/Random%20Assign%202.png)
:::

::: {.column width="50%"}
-   Since we have a more even mix of plants from either group exposed to the sun and darkness, we can infer causality since we are considering confounding variables

-   The important thing to remember about establishing causality is we need to compare apples to apples! This is why your counterfactual is so important
:::
:::

## Random Assignment

-   Alternatively, consider you create a new asthma medication, and you want to test its effectiveness before entering the market
-   You decide to conduct a randomized control trial (RCT)
    -   You gather participants for your control group by asking individuals with asthma from low-income areas and individuals for your treatment group from more affluent areas
    -   What is the problem with this?

::: incremental
-   To infer causality, you want to randomly assign participants into groups to avoid issues of confounding variables
:::

## Natural Experiments

-   Often, in economics it is difficult if not impossible to conduct an experiment to answer a research question
    -   It unethical to say, "What happens if we give half the country \$1M and the other half nothing"

::: incremental
-   Therefore, economist rely on [natural experiments]{.hi} where a policy or interventions creates control and treatment groups that are "as good as randomly" assigned

-   Example: Economist and policymakers are interested in how immigration impacts labor markets

    -   What are some concerns with increased immigration, from theory?
        -   Depressed wages of existing workers
        -   Increased unemployment
    -   How would we design an RCE to test this?
:::

## Natural Experiments

:::columns
::: {.column width="50%"}
- There are ethical concerns with randomly selecting immigrants and forcing them into the U.S

- David Card (1990) used a natural experiment to test what happens wages and unemployment when there is an influx of immigrants

- While this is a natural experiment, is it as good as random?
  - No, the immigrants were largely low-skilled and selected into (choose to) immigration

:::

::: {.column width="50%"}
![](images/boat lift.png)
:::
:::

## Forecasting and Causality
 - Some economic questions do not require identifying causal effects, but instead use data to predict what will happen

:::incremental
- [Prediction]{.hi} is the usage of information on variables to make statements about another variable 
  - Can include subjectivity
  - Suppose you have a deck of cards and you are looking at 40 of the cards. If you want to predict what card you will draw next you will use information on the 40 you observe and a â€˜gut feelingâ€™

- [Forecasting]{.hi} is an estimation about the value of a variable in the future
   - Uses statistical models
  - Weather forecast uses data on atmospheric conditions to forecast temp, percip, wind, etc.

- Knowing causality is not required to make good predictions. Why?

:::

## Forecsting and Causality

:::columns
::: {.column width="50%"}
- Consider the two variables in the plot and look at the correlation coefficient 
- Does either cause the other?
- Can we make strong forecasts about cheese consumption based on deaths?

:::


::: {.column width="50%"}
![](images/cheese.png)
:::
:::



