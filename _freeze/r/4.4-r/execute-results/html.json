{
  "hash": "80f3b815c43d65547110799c49a2297b",
  "result": {
    "markdown": "---\ntitle: \"4.4 — Nonlinearities & Variable Transformations — Practice\"\nexecute:\n  freeze: auto\n---\n\n\n<p style=\"text-align:center\"><a target=\"_blank\" href=\"https://metricsF22.classes.ryansafner.com/files/r-qmd/4_4_nonlinearities_and_variable_transformations.qmd\"><span class=\"btn btn-primary btn-lg\"><i class=\"fas fa-file-archive\"></i>Quarto file</a></span> <a target=\"_blank\" href=\"https://rstudio.cloud/spaces/270168/content/4968381\"><span class=\"btn btn-primary btn-lg\"><i class=\"fas fa-cloud\"></i>R Studio Cloud</a></span></p>\n\n## Answers\n\n<p style=\"text-align:center\"><a target=\"_blank\" href=\"https://metricsF22.classes.ryansafner.com/files/r-qmd/4_4_nonlinearities_and_variable_transformations_answers.html\"><span class=\"btn btn-primary btn-lg\"><i class=\"fas fa-external-link-square-alt\"></i> Answer Key (html) </a></span> <a target=\"_blank\" href=\"https://metricsF22.classes.ryansafner.com/files/r-qmd/4_4_nonlinearities_and_variable_transformations_answers.qmd\"><span class=\"btn btn-primary btn-lg\"><i class=\"fas fa-file-archive\"></i> Answer Key (.qmd)</a></span></p>\n\n## Required Packages & Data\n\nLoad all the required packages we will use (**note I have installed them already into the cloud project**) by running (clicking the green play button) the chunk below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # your friend and mine\nlibrary(broom) # for tidy regression\nlibrary(modelsummary) # for nice regression tables\nlibrary(car) # for F-test\n```\n:::\n\n\n\nWe are returning to the speeding tickets data that we began to explore in [R Practice 4.1 on Multivariate Regression](http://metricsf22.classes.ryansafner.com/r/4.1-r) and [R Practice 4.3 on Categorical Data nad Interactions](https://metricsf22.classes.ryansafner.com/r/4.3-r). Download and read in (`read_csv`) the data below.\n\n- [<i class=\"fas fa-table\"></i> `speeding_tickets.csv`](http://metricsf21.classes.ryansafner.com/data/speeding_tickets.csv)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in data from url \n# or you could download and upload it to this project instead\nspeed <- read_csv(\"https://metricsf22.classes.ryansafner.com/files/data/speeding_tickets.csv\") %>%\n  mutate_at(c(\"Black\", \"Hispanic\", \"Female\", \"OutTown\", \"OutState\"), factor) %>%\n  filter(Amount > 0)\n```\n:::\n\n\nThis data comes from a paper by Makowsky and Strattman (2009) that we will examine later. Even though state law sets a formula for tickets based on how fast a person was driving, police officers in practice often deviate from that formula. This dataset includes information on all traffic stops. An amount for the fine is given only for observations in which the police officer decided to assess a fine. There are a number of variables in this dataset, but the one's we'll look at are:\n\n| Variable   | Description                                                                        |\n|--------------|---------------------------------------------------------|\n| `Amount`   | Amount of fine (in dollars) assessed for speeding                                  |\n| `Age`      | Age of speeding driver (in years)                                                  |\n| `MPHover`  | Miles per hour over the speed limit                                                |\n| `Black`    | Dummy $=1$ if driver was black, $=0$ if not                                        |\n| `Hispanic` | Dummy $=1$ if driver was Hispanic, $=0$ if not                                     |\n| `Female`   | Dummy $=1$ if driver was female, $=0$ if not                                       |\n| `OutTown`  | Dummy $=1$ if driver was not from local town, $=0$ if not                          |\n| `OutState` | Dummy $=1$ if driver was not from local state, $=0$ if not                         |\n| `StatePol` | Dummy $=1$ if driver was stopped by State Police, $=0$ if stopped by other (local) |\n\nWe want to explore **who gets fines, and how much**. We'll come back to the other variables (which are categorical) in this dataset in later lessons.\n\n## Question 1\n\nRun a regression of `Amount` on `Age`. Write out the estimated regression equation, and interpret the coefficient on Age.\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n\n## Question 2\n\nIs the effect of `Age` on `Amount` nonlinear? Let's run a quadratic regression.\n\n### Part A\n\nCreate a new variable for $Age^2$. Then run a quadratic regression:\n\n\n$$\\widehat{\\text{Amount}}_i=\\beta_0+\\beta_1 \\, \\text{Age}_i+\\beta_2 \\, \\text{Age}_i^2$$\n\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n\n### Part B\n\nTry running the same regression using the alternate notation: `lm(Y ~ X + I(X^2))`, replacing `X` and `Y` with our variables. This method allows you to run a quadratric regression without having to create a new variable first. Do you get the same results?\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part C\n\nWrite out the estimated regression equation.\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part D\n\nIs this model an improvement from the linear model? Compared $\\bar{R}^2$.\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part E\n\nIs the coefficient on the quadratic term statistically significantly different from zero? i.e. could we reject $H_0: \\beta_2$?\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part F\n\nWrite an equation for the marginal effect of `Age` on `Amount`.\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part G\n\nPredict the marginal effect on `Amount` of being one year older when you are 18. How about when you are 40?\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part H\n\nOur quadratic function is a $U$-shape. According to the model, at what age is the amount of the fine minimized?\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part I\n\nCreate a scatterplot between `Amount` (`y`) and `Age` (`x`). Add a layer with a linear regression (as usual, `geom_smooth(method = \"lm\")`), and an additional layer of with the predicted quadratic regression curve. This additional layer is similar but we need to specify the formula of the curve to be quadratic:\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part J\n\nIt's quite hard to see the quadratic curve with all those data points. Redo another plot and this time, only keep the quadratic `geom_smooth()` layer and leave out the `geom_point()` layer. This will only plot the regression curve.\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n## Question 3\n\nShould we use a higher-order polynomial equation? Run the following cubic regression, and determine whether it is necessary.\n\n\n$$\\widehat{\\text{Amount}}_i = \\beta_0 + \\beta_1 \\, \\text{Age}_i + \\beta_2 \\, \\text{Age}_i^2 + \\beta_3 \\, \\text{Age}_i^3$$\n\n\n## Question 4\n\nRun an $F$-test to check if a nonlinear model is appropriate. Use the `car` package's `linearHypothesis()` command, which looks like:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlinearHypothesis(reg_name, # name of your saved regression object\n                 c(\"var1\", \"var2\")) # name of the variables you are testing\n```\n:::\n\n\nYour null hypothesis is $H_0: \\beta_2=\\beta_3=0$ from the regression in question 4. The command is \n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n\n## Question5 \n\nNow let's take a look at speed (`MPHover` the speed limit).\n\n### Part A\n\nCreating new variables as necessary, run a **linear-log** model of `Amount` on `MPHover`. Write down the estimated regression equation, and interpret the coefficient on `MPHover` $(\\hat{\\beta_1})$. Make a scatterplot with the regression line. Hint: The simple `geom_smooth(method = \"lm\")` layer is sufficient, so long as you use the right variables on the plot!\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part B\n\nCreating new variables as necessary, run a **log-linear** model of `Amount` on `MPHover`. Write down the estimated regression equation, and interpret the coefficient on `MPHover` $(\\hat{\\beta_1})$. Make a scatterplot with the regression line. Hint: The simple `geom_smooth(method = \"lm\")` is sufficient, so long as you use the right variables on the plot!\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part C\n\nCreating new variables as necessary, run a **log-log** model of `Amount` on `MPHover`. Write down the estimated regression equation, and interpret the coefficient on `MPHover` $(\\hat{\\beta_1})$. Make a scatterplot with the regression line. Hint: The simple `geom_smooth(method = \"lm\")` is sufficient, so long as you use the right variables on the plot!\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part D\n\nWhich of the three log models has the best fit? Hint: Check $R^2$\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n\n## Question 6\n\nReturn to the quadratic model from Question 3. Run a quadratic regression of `Amount` on `Age`, `Age`$^2$, `MPHover`, and all of the race dummy variables. Test the null hypothesis: *“the race of the driver has no effect on Amount”*\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n## Question 7\n\nNow let's try standardizing variables. Let's try running a regression of `Amount` on `Age` and `MPHover`, but standardizing each variable. \n\n### Part A\n\nCreate new standardized variables for `Amount`, `Age`, and `MPHover`:\n\n<!--WRITE YOUR ANSWERS BELOW -->\n\n### Part B\n\nRun a regression of standardized `Amount_Z` on standardized `Age_Z` and `MPHover_Z`. Interpret $\\hat{\\beta_1}$ and $\\hat{\\beta_2}$. Which variable has a bigger effect on `Amount`?\n",
    "supporting": [
      "4.4-r_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}